<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo de Tenis üéæ - Manager Flexible</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="header-container">
        <h1>Gestor de Torneo de Tenis Flexible</h1>
        <button onclick="borrarDatos()" class="danger-btn" id="global-reset-btn">
            Reiniciar Todo (Borrar Datos)
        </button>
    </div>

    <section id="configuracion">
        <!-- Nuevo contenedor para mostrar el ID del Torneo -->
        <div id="tournament-info-container" class="mt-4 p-3 bg-gray-100 rounded-lg shadow-inner">
            <p class="text-sm font-semibold text-gray-700">
                ID del Torneo (Firebase): <span id="tournament-id-display" class="font-mono text-indigo-600 break-all">Cargando...</span>
            </p>
        </div>
        <h2>1. Configuraci√≥n del Torneo</h2>
        <div id="config-form">
            <label for="max-jugadores-input">N√∫mero Total de Participantes (debe ser par):</label>
            <input type="number" id="max-jugadores-input" min="2" step="2" value="10">
            <button onclick="configurarMaxJugadores()">Establecer</button>
        </div>
        <p>Tama√±o del Torneo Establecido: <span id="max-jugadores-actual">10</span> jugadores.</p>
    </section>

    <section id="registro">
        <h2>2. Inscripci√≥n de Jugadores</h2>
        <div id="registro-form">
            <input type="text" id="nombre-input" placeholder="Nombre del Jugador">
            <button onclick="agregarParticipante()">A√±adir Jugador</button>
        </div>
        <p>Participantes actuales: <span id="contador-participantes">0</span> / <span id="max-participantes-display">10</span></p>
        <ul id="lista-participantes"></ul>
        <button id="btn-iniciar" onclick="iniciarTorneo()" disabled>Iniciar Torneo</button>
    </section>

    <hr>

    <section id="grupos-fixture" style="display: none;">
        <h2>3. Fase de Grupos y Partidos</h2>
        <div class="mt-4 p-4 bg-purple-50 rounded-lg shadow-md">
            <button onclick="generateTournamentAnalysis()" id="btn-gemini-analysis"
                class="w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition duration-300">
                Generar An√°lisis Estrat√©gico ‚ú®
            </button>
            <div id="analysis-container" class="mt-3 text-gray-700 whitespace-pre-wrap">
                <!-- El an√°lisis de Gemini se insertar√° aqu√≠ -->
            </div>
            <p id="analysis-loading" class="text-purple-600 mt-2 hidden">Analizando estrategia con Gemini...</p>
        </div>
        <div id="grupos-container">
        </div>

        <h3>Registro de Resultados de Grupos</h3>
        <div id="partidos-registro-grupos">
        </div>
    </section>

    <hr>

    <section id="ranking-finales" style="display: none;">
        <h2>4. Rankings y Playoff</h2>

        <div id="rankings-container">
        </div>
        
        <div id="playoffs-registro">
            <h3>Registro de Resultados de Playoff</h3>
            
            <form id="score-form">
                <label for="player-name">Nombre del Jugador:</label>
                <input type="text" id="player-name" required placeholder="Ej: Juan P√©rez"><br><br>

                <label for="player-score">Puntuaci√≥n de Playoff:</label>
                <input type="number" id="player-score" required min="0" value="0"><br><br>
                
                <button type="submit">Guardar Resultado de Playoff</button>
                <p id="message-area" style="color: blue; margin-top: 10px;"></p>
            </form>

        </div>

        <div id="playoffs">
        </div>
    </section>

    <!-- ========================================================= -->
    <!-- INICIALIZACI√ìN DE FIREBASE (V8 CDN y Configuraci√≥n) -->
    <!-- Aseg√∫rate de que estos scripts est√©n al final del body -->
    <!-- ========================================================= -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            // Nota: Aqu√≠ est√° tu clave API real
            apiKey: "AIzaSyAPUcbUnT7Fabp8TQUj-_5M4Ox4Ip_c3GA", 
            authDomain: "precisiontennisscores.firebaseapp.com",
            projectId: "precisiontennisscores",
            storageBucket: "precisiontennisscores.firebasestorage.app",
            messagingSenderId: "847832314171",
            appId: "1:847832314171:web:ce61405a155f67bf4ac71e",
            measurementId: "G-C842BQXWXN"
        };
        
        // Initialize Firebase (V8)
        const app = firebase.initializeApp(firebaseConfig);
        // La variable 'db' es crucial y ahora est√° definida correctamente
        const db = firebase.firestore(); 
        
        console.log("‚úÖ Firebase App and Firestore initialized!");

        // La funci√≥n de prueba de escritura inmediata ha sido eliminada.
        // La escritura ahora depende de la funci√≥n configurarMaxJugadores() en my-app-logic.js
    </script>
        
    <!-- L√≥gica principal de la aplicaci√≥n -->
    <script src="my-app-logic.js"></script>

    <!-- Nueva Secci√≥n para Cargar un Torneo Existente (Sincronizaci√≥n) -->
    <section id="cargar-torneo" class="mt-8 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-lg">
        <h2>Cargar Torneo Existente üîÑ</h2>
        <p class="text-sm mb-3">Pega el ID del torneo de otro dispositivo para sincronizarlo aqu√≠.</p>
        <form id="load-tournament-form">
            <input type="text" id="external-id-input" placeholder="Pegar ID del Torneo aqu√≠" required 
                   class="p-2 border border-yellow-500 rounded-md w-full mb-2 text-black">
            <button type="submit" class="w-full bg-yellow-600 text-white p-2 rounded-md hover:bg-yellow-700 transition">
                Cargar Torneo
            </button>
        </form>
    </section>
    
</body>
</html>
